otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
secseqs <- c()
for (seq in (setdiff(names(otu_data), nome_coluna_maior_valor))) {
if (otu_data[seq] >= 0.1) {secseqs <- append(secseqs, seq)}
}
print(sample_name)
print(paste0("Top taxa: ",topseq))
print(paste0("Other relevant taxas: ",paste(secseqs, collapse = " ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
secseqs <- c()
for (seq in (setdiff(names(otu_data), nome_coluna_maior_valor))) {
if (otu_data[seq] >= 0.1) {secseqs <- append(secseqs, seq)}
}
print(sample_name)
print(paste0("Top taxa: ",topseq))
print(paste0("Other relevant taxas: ",paste(secseqs, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
tax_table(ps.toptaxa_sample)
tax_table(ps.toptaxa_sample)[Seq_1]
tax_table(ps.toptaxa_sample)["Seq_1"]
tax_table(ps.toptaxa_sample)["Seq_2"]
tax_table(ps.toptaxa_sample)["Seq_3"]
tax_table(ps.toptaxa_sample)["Seq_4"]
tax_table(ps.toptaxa_sample)["Seq_5"]
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
secseqs <- c()
for (seq in (setdiff(names(otu_data), nome_coluna_maior_valor))) {
if (otu_data[seq] >= 0.1) {secseqs <- append(secseqs, seq)}
}
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(secseqs, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
secseqs <- c()
for (seq in (setdiff(names(otu_data), nome_coluna_maior_valor))) {
if (otu_data[seq] >= 0.1) {secseqs <- append(secseqs, seq)}
}
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(secseqs, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), nome_coluna_maior_valor))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), toptaxa))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
#sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
sectaxas <- tax_table(ps.toptaxa_sample)[secseqs]
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.05) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
print(sample_name)
print(paste0("Top taxa: ",toptaxa))
print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
print("-----")
#create_report(sample_name)
}
system(paste("echo Saving taxonomy table and blast output..."))
tax_table1<-"data/taxtable.txt"
write.table(taxtab, file=paste0(path,tax_table1))
tax_tablecsv<-"data/taxtable.csv"
write.csv(taxtab, file=paste0(path,tax_tablecsv)) # just so it can be easily read by excel
# same thing for blasttable
blasttable <- read.table(paste0(path, blastout))
colnames(blasttable) <- c("qseq", "qid", "sid", "pident", "length", "mismatch", "gapopen", "qstart", "qend", "sstart", "send", "evalue", "bitscore")
blast_out<-"data-raw/blastout.csv"
write.csv(blasttable,file=paste0(path,blast_out))
system(paste("echo ##### Analysis Complete #####"))
create_report <- function(sample,top,sec){
rmarkdown::render(input = "MitoSonar_report.Rmd",
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path,"reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
path = paste0(system(paste0(pwd)),"/work-dir/")
path = paste0(system(paste0("pwd")),"/work-dir/")
path = paste0(cat(system(paste0("pwd"))),"/work-dir/")
system(paste0("pwd")
)
path0 = system(paste0("pwd")
path = cat(),"/work-dir/")
path0 = system(paste0("pwd"))
path0
path0 = system("pwd", intern = TRUE)
path0
path = paste0(path0,"/work-dir/")
path = "/home/carloslima/projects/MitoSonar/work-dir/"
path0 = "/home/carloslima/projects/MitoSonar"
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path,"reports")
rep_dir <- paste0(path0,"reports")
rep_dir <- paste0(path0,"/reports")
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"/MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path0,"/reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
rep_dir <- paste0(path0,"reports")
rep_dir <- paste0(path,"reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"/MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path0,"/reports"),
intermediates_dir = paste0(path0,"/reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path0,"/reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"/MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path,"reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
setwd(path0)
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
setwd("~/projects/MitoSonar/work-dir")
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"/MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path,"reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
create_report <- function(sample,top,sec){
rmarkdown::render(input = paste0(path0,"/MitoSonar_report.Rmd"),
output_format = rmarkdown::pdf_document(),
output_file = paste0(sample,"MSReport"),
output_dir = paste0(path,"reports"),
intermediates_dir = paste0(path,"reports"),
clean = TRUE,
params = list(sample = sample,
maxN = maxN,
truncQ = truncQ,
truncLen = truncLen,
trimLeft = trimLeft,
maxEE = maxEE,
species = top,
species2 = sec))
}
rep_dir <- paste0(path,"reports")
if(!dir.exists(rep_dir)){dir.create(rep_dir)}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
for (sample_name in sam_names) {
ps.toptaxa_sample <- prune_samples(sample_name, ps.toptaxa)
otu_data <- as.data.frame(otu_table(ps.toptaxa_sample))
topseq <- names(otu_data)[which.max(otu_data)]
toptaxa <- tax_table(ps.toptaxa_sample)[topseq]
sectaxas <- c()
for (seq in (setdiff(names(otu_data), topseq))) {
if (otu_data[seq] >= 0.1) {
secseq <- seq
sectaxas <- append(sectaxas,tax_table(ps.toptaxa_sample)[secseq])
}
}
#print(sample_name)
#print(paste0("Top taxa: ",toptaxa))
#print(paste0("Other relevant taxas: ",paste(sectaxas, collapse = ", ")))
#print("-----")
create_report(sample_name,toptaxa,sectaxas)
}
