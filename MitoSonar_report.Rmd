---
header-includes:
   - \usepackage[default]{sourcesanspro}
   - \usepackage[T1]{fontenc}
mainfont: SourceSansPro
output:
  pdf_document: default
params:
  sample: "sample"
  maxN: "maxN"
  truncQ: "truncQ"
  truncLen: "truncLen"
  trimLeft: "trimLeft"
  maxEE: "maxEE"
  species: "Genus species"
  species2: "Genus species"
  database: "MiFish"
  inputtype: "pair"
---

```{r, echo=FALSE}
knitr::opts_chunk$set(echo = FALSE, dev="cairo_pdf")
```

![](work-dir/data/images/assets/catg_header.png){width="536"}

# Laudo Metagenômico

![](work-dir/data/images/assets/Logo.jpeg){width="167"}

## Resumo do Serviço

Nome: MitoSonar - Metabarcoding `r if(params$database=='MiFish'){'12s Písceo'}else if(params$database=='Silva'){'16s Bacteriano'}else if(params$database=='UNITE'){'ITS Fúngico'}`.

Descrição geral: Identificação taxonômica de `r if(params$database=='MiFish'){'peixes'}else if(params$database=='Silva'){'bactérias'}else if(params$database=='UNITE'){'fungos'}` através de comparação de amostras da região `r if(params$database=='MiFish'){'12s do DNA mitocondrial'}else if(params$database=='Silva'){'16s do rRNA'}else if(params$database=='UNITE'){'ITS do rRNA'}` contra um banco de dados de espécies conhecidas.

Versão do Relatório: b.0.0

Data: `r format(Sys.time(), '%d/%m/%y')`

Amostra: Este laudo é referente à amostra `r if(params$inputtype=='pair'){'pair'}else{'single'}`-end com identificador `r params$sample`, que foi sequenciada e analisada em metabarcoding por cruzamento com um banco de dados de sequências conhecidas.

\newpage

## Workflow da análise

### *Sequenciamento*

As amostras foram sequenciadas utilizando a metodologia de A IMPLEMENTAR PREENCHIMENTO PELO USUÁRIO NA CHAMADA DO SCRIPT.

### *Análise Bioinformática*

Após o final do sequenciamento, foram executadas as análises bioinformáticas. Inicialmente as leituras geradas (no formato fastq) passaram por uma avaliação da qualidade. Em seguida, as sequências foram filtradas, seguindo para uma etapa de inferência das sequences. Após a remoção de quimeras, foram construídas as tabelas de sequences e OTUs, e estas foram comparadas ao banco de dados de referência.

### *Limpeza dos dados*

As leituras geradas no sequenciamento passaram por um processo de limpeza, sendo retirada as sequências de baixa qualidade e adaptadores. Os seguintes parâmetros foram utilizados:

-   Leituras com mais de `r params$maxN` Ns foram removidas;
-   Leituras com taxa de erros estimados superior a `r params$maxEE` foram removidas;
-   Leituras contendo porções com taxa de erro superior a `r params$truncQ` truncadas na primeira ocorrência desta;
-   Leituras menores que `r params$truncLen` pares de bases foram removidas, e as maiores, truncadas;
-   As primeiras `r params$trimLeft` bases foram removidas das leituras.

\newpage

### *Perfis de qualidade dos dados antes e depois da limpeza das leituras*

#### Sobre os gráficos:

O que mostra: A distribuição das pontuações de qualidade de Phred para cada posição ao longo de todas as leituras.

Como interpretar: Idealmente, a maioria das pontuações deve estar acima de Q20 (qualidade de erro de 1 em 100).

*Antes da filtragem*

```{r, echo=FALSE, out.width = '50%'}
if (params$inputtype == "pair") {
  knitr::include_graphics(c(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_forward_quality.png"),(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_reverse_quality.png"))))
} else {
  knitr::include_graphics(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_quality.png"))
}
```

*Depois da filtragem*

```{r, echo=FALSE, out.width = '50%'}
if (params$inputtype == "pair") {
  knitr::include_graphics(c(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_forward_filtered_quality.png"),(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_reverse_filtered_quality.png"))))
} else {
  knitr::include_graphics(paste0("work-dir/data/images/plots/",params$sample,"_quality_report/", params$sample,"_filtered_quality.png"))
}
```

\newpage

### *Estimativa de erros nas leituras por base*

#### Sobre os gráficos

O que mostra: Eixo X: Representa as posições das bases na leitura de sequenciamento. Eixo Y: Mostra a taxa de erro logarítmica estimada para a base específica em cada posição.

Como interpretar: Normalmente, espera-se que as taxas de erro aumentem perto do final das leituras, devido à degradação da qualidade do sinal no sequenciamento. Um aumento nas taxas de erro em posições mais iniciais pode indicar problemas na qualidade do sequenciamento ou na preparação da amostra.

Nos gráficos, a "linha ideal" representa a relação entre o valor de qualidade reportado pelas leituras de sequenciamento e a taxa de erro esperada com base nessa qualidade de base. O propósito dessa linha é fornecer uma referência para comparar as taxas de erro observadas com o que seria teoricamente esperado. Sendo assim, quanto mais semelhante à "linha ideal" o traçado do gráfico for, melhor.

```{r, echo=FALSE, out.width = '50%'}
knitr::include_graphics(c(paste0("work-dir/data/images/plots/",params$sample,"_estimated_errors/", params$sample,"_estimErr_A.png"),(paste0("work-dir/data/images/plots/",params$sample,"_estimated_errors/", params$sample,"_estimErr_C.png"))))
```

```{r, echo=FALSE, out.width = '50%'}
knitr::include_graphics(c(paste0("work-dir/data/images/plots/",params$sample,"_estimated_errors/", params$sample,"_estimErr_G.png"),(paste0("work-dir/data/images/plots/",params$sample,"_estimated_errors/", params$sample,"_estimErr_T.png"))))
```

\newpage

### *Identificação de taxonomias*

Para identificação do organismo presente na amostra após o tratamento dos dados, foi utilizada a estratégia de comparação com o banco de dados MiFish.

```{r, echo=FALSE, out.width = '75%'}
knitr::include_graphics(paste0("work-dir/data/images/plots/",params$sample,"_toptaxa.png"))
```

## Conclusão

Ao final da comparação podemos concluir que o material predominate pertence à espécie: ***`r paste0(params$species)`***.

```{r, echo=FALSE}
if (length(params$species2)>=1)
print(paste0("Além disso, detectou-se uma presença significativa (>10% da amostra) de traços de ", params$species2))
```

\newpage

## Referências

-   RIAZ, T. et al. ecoPrimers: inference of new DNA barcode markers from whole genome sequence analysis. Nucleic Acids Research, v. 39, n. 21, p. e145–e145, 1 nov. 2011.

-   STOECKLE, M. Y. et al. Trawl and eDNA assessment of marine fish diversity, seasonality, and relative abundance in coastal New Jersey, USA. ICES Journal of Marine Science, v. 78, n. 1, p. 293–304, 24 mar. 2021.

-   STOECKLE, M. Y. et al. Current laboratory protocols for detecting fish species with environmental DNA optimize sensitivity and reproducibility, especially for more abundant populations. ICES Journal of Marine Science, v. 79, n. 2, p. 403–412, 10 mar. 2022.

-   STOECKLE, M. Y.; AUSUBEL, J. H.; COOGAN, M. 12S Gene Metabarcoding with DNA Standard Quantifies Marine Bony Fish Environmental DNA, Identifies Threshold for Reproducible Amplification, and Overcomes Distortion Due to Non-Fish Vertebrate DNA. [s.l.] Ecology, 2 ago. 2022. Disponível em: <http://biorxiv.org/lookup/doi/10.1101/2022.07.29.502053>. Acesso em: 13 dez. 2023.

-   STOECKLE, M. Y.; DAS MISHU, M.; CHARLOP-POWERS, Z. Improved Environmental DNA Reference Library Detects Overlooked Marine Fishes in New Jersey, United States. Frontiers in Marine Science, v. 7, p. 226, 5 maio 2020.

-   STOECKLE, M. Y.; SOBOLEVA, L.; CHARLOP-POWERS, Z. Aquatic environmental DNA detects seasonal fish abundance and habitat preference in an urban estuary. PLOS ONE, v. 12, n. 4, p. e0175186, 12 abr. 2017.
